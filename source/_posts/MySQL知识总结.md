---
title: MySQL知识总结
date: 2025-07-24T22:51:29+08:00
tags:
- 学习过程
- 数据库
categories: 面试知识
index_img: https://qjw-00.oss-cn-guangzhou.aliyuncs.com/%E4%B8%AA%E4%BA%BA%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8/mysql.webp
---
# MYSQL

## 1.MYSQL优化问题

### 一、如何定位慢查询？

**原因：**

- 聚合查询
- 多表查询
- 表数据量过大查询
- 深度分页查询
- 表象：页面加载过慢、接口压测响应时间超过1s

**工具**：

- 调试工具：arthas

- 运维工具：prometheus、**skywalking**

- MYSQL中自带的慢日志查询，需要配置开启和设置慢日志的时间。

  ![image-20250521093312135](C:\Users\14376\AppData\Roaming\Typora\typora-user-images\image-20250521093312135.png)

**回答**：先介绍自己的场景+用的工具+扩展自己知道的其他知识

### 二、定位到了语句之后，如何分析呢？

**工具/语句：**

在语句面前添加**EXPLAN或者DESC**

- possible-keys：当前sql可能用到的索引
- **key：实际命中的索引**
- **key-len：索引占用的大小**
- **extra：额外的优化建议，是否出现了回表（如果出现using index condition 就表明有优化的空间）**
- **type**：连接类型，性能由好到坏：NULL、system、**const（主键查询）、eqref（唯一索引或者主键索引查询）、ref（索引查询）、range（范围查询）**、index（全索引查询）、all（全盘扫描）

**回答**：

面试官：那这个SQL语句执行很慢，如何分析呢？
候选人：如果一条sgl执行很慢的话，我们通常会使用mysal自动的执行计划explain来去查看这条sql的执行情况，

比如在这里面可以通过key和key_len检查是否命中了索引，如果本身已经添加了索引，也可以判断索引是否有失效的情况，第二个，可以通过yp字段查看sql是否有进一步的优化空间，是否存在全索引扫描或全盘扫描，第三个可以通过extra建议来判断，是否出现了回表的情况，如果出现了，可以尝试添加索引或修改返回字段来修复

### 三、什么是索引？

**回答**（定义+特点）

- **索引(index)是帮助MySQL高效获取数据的数据结构（有序）**
- 提高数据检索的效率，降低数据库的IO成本（不需要全表扫描）
- 通过索引列对数据进行排序（B+树），降低数据排序的成本，降低了CPU的消耗

### 四、索引的底层（B+树和特点）

​	mysql的inmoDB引擎采用的是B+树的数据结构来存储索引

- 阶数更多，路径更短

- 磁盘读写代价B+树更低，**非叶子节点只存储指针**，叶子阶存储数据

- B+树便于扫库和区间查询，叶子节点是一个**双向链表**

  可能会问B+树和B树的区别

### 五、什么是聚簇索引？

**回答**

- **聚簇索引（聚集索引）**：数据和索引放到一块，B+树的叶子节点保存整行数据，有且只有一个
- **非聚簇索引（二级索引）**：数据和索引分开存储，B+树的叶子节点保存对应的主键，可以有多个

### 六、什么是回表查询？

**回答**（五+六）

- 通过二级索引查找到主键值，到聚集索引中查找整行数据，这个过程就是回表查询。  


### 七、覆盖索引

**回答**

覆盖索引是指查询使用了索引，返回的列，必须在索引中全部能够找到

- 使用id查询（主键），直接走聚集索引查询，一次索引扫描，直接返回整行数据，效率高
- 如果返回的列中没有所要查询的字段，有可能会触发回表查询，所以尽量避免用select*

### 八、超大分页如何处理

**定义**

在数据量比较大时，如果进行limit分页查询，在查询时，越往后，效率越低

**回答**

可以用覆盖索引+子查询来解决。

![image-20250521182106204](C:\Users\14376\AppData\Roaming\Typora\typora-user-images\image-20250521182106204.png)

![image-20250521182109221](C:\Users\14376\AppData\Roaming\Typora\typora-user-images\image-20250521182109221.png)

> **面试官：知道什么叫覆盖索引嘛？**
> 候选人：嗯~，清楚的
> 覆盖索引是指select查询语句使用了索引，在返回的列，必须在索引中全部能够找到，如果我们使用id查询，它会直接走聚集索引查询，一次索引扫描，直接返回数据，性能高。
> 如果按照二级索引查询数据的时候，返回的列中没有创建索引，有可能会触发回表查询，尽量避免使用select*,尽量在返回的列中都包含添加索引的字段
> **面试官：MYSQL超大分页怎么处理？**
> 候选人：嗯，超大分页一般都是在数据量比较大时，我们使用了Iit分页查询，并且需要对数据进行
> 排序，这个时候效率就很低，我们可以采用覆盖索引和子查询来解决
> 先分页查询数据的id字段，确定了id之后，再用子查询来过滤，只查询这个id列表中的数据就可以了
> 因为查询i的时候，走的覆盖索引，所以效率可以提升很多

### 九、索引创建的原则（1256要提及）

1. **数据量较大，且查询频繁的表（单表超过10万数据）**
2. **常作为查询条件、排序、分组（where、order by 、 group by）操作**
3. 尽量选择**区分度高**的列作为索引，区分度越高，效率越高
4. 如果是字符串类型的字段，可以利用**字符串的特点建立前缀索引**
5. **尽量使用联合索引**，查询时很多时候联合索引可以覆盖索引，节省存储空间，避免回表。
6. **控制索引数量**
7. 如果索引列不能存NULL要加**not null**！！

### 十、索引失效

**判断标准**

- 违反了最左前缀法则
- 范围查询右边的列是无法使用范围索引的
- 不要再索引列上进行运算操作，否则索引失效
- 字符串不加单引号
- 以like开头的模糊索引会导致失效

**工具**

执行计划explain

### 十一、sql的优化经验

- 表的设计优化
- 索引优化  		（**九+十**）
- sql语句的优化	   	
- 主从复制，读写分离
- 分库分表



#### 表的设计优化（参考阿里开发手册）

1. 设置合适的数值，根据实际情况选择（tinyint int bigint）
2. char和varchar，char定长效率高，var可变长度，效率低一些

#### sql语句的优化

1. select语句避免*
2. sql避免索引失效
3. union all 代替 union ，union会多一次过滤，效率低
4. 避免where子句中对字段进行表达式操作
5. join优化，能用innerjoin就不用左右join，如果要用，一定要以小表为驱动，内连接会对两个表进行优化，优先把小表放外边，大表放里边，左右join不会重新排序






## 2.事务

